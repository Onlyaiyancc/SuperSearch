<Window x:Class="SuperSearch.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:shell="clr-namespace:System.Windows.Shell;assembly=PresentationFramework"
        xmlns:vm="clr-namespace:SuperSearch.ViewModels"
        mc:Ignorable="d"
        Title="Super Search"
        Width="720"
        SizeToContent="Height"
        MinWidth="560"
        WindowStartupLocation="Manual"
        WindowStyle="None"
        ResizeMode="NoResize"
        AllowsTransparency="False"
        Background="#11131A"
        ShowInTaskbar="False"
        Topmost="True">
    <WindowChrome.WindowChrome>
        <shell:WindowChrome CaptionHeight="0"
                             ResizeBorderThickness="0"
                             GlassFrameThickness="0"
                             UseAeroCaptionButtons="False"
                             CornerRadius="0" />
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibility" />
        <SolidColorBrush x:Key="ShellFill" Color="#14151E" />
        <SolidColorBrush x:Key="ShellStroke" Color="#2A2F40" />
        <SolidColorBrush x:Key="SearchBarFill" Color="#1C1F2C" />
        <SolidColorBrush x:Key="SearchText" Color="#F5F7FF" />
        <SolidColorBrush x:Key="SearchPlaceholder" Color="#66718C" />
        <SolidColorBrush x:Key="BadgeFill" Color="#222C43" />
        <SolidColorBrush x:Key="BadgeText" Color="#9FB5FF" />
        <SolidColorBrush x:Key="AccentBrush" Color="#4C7BFF" />
        <SolidColorBrush x:Key="ResultBackground" Color="#191C28" />
        <SolidColorBrush x:Key="ResultHover" Color="#22263A" />
        <SolidColorBrush x:Key="ResultSelected" Color="#3A6CFF" />
        <SolidColorBrush x:Key="ResultSelectedText" Color="#F5F7FF" />
        <SolidColorBrush x:Key="PrimaryText" Color="#F1F3FF" />
        <SolidColorBrush x:Key="MutedText" Color="#959EB8" />

        <Style TargetType="ScrollBar" x:Key="CustomVerticalScrollBar">
            <Setter Property="Width" Value="8" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollBar">
                        <Grid Width="8" Background="Transparent">
                            <Border Background="#1E2230" CornerRadius="4" Opacity="0.6" />
                            <Track x:Name="PART_Track" IsDirectionReversed="True">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Height="0" Command="{x:Static ScrollBar.LineUpCommand}" />
                                </Track.DecreaseRepeatButton>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Height="0" Command="{x:Static ScrollBar.LineDownCommand}" />
                                </Track.IncreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb>
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="Thumb">
                                                <Border Background="#4C7BFF" CornerRadius="4" Margin="0,2" />
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="ScrollViewer">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ScrollViewer">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <ScrollContentPresenter Grid.Column="0"
                                                    Content="{TemplateBinding Content}" />
                            <ScrollBar Grid.Column="1"
                                       Orientation="Vertical"
                                       Style="{StaticResource CustomVerticalScrollBar}"
                                       Maximum="{TemplateBinding ScrollableHeight}"
                                       ViewportSize="{TemplateBinding ViewportHeight}"
                                       Visibility="{TemplateBinding ComputedVerticalScrollBarVisibility}"
                                       Value="{Binding VerticalOffset, RelativeSource={RelativeSource TemplatedParent}, Mode=OneWay}" />
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ResultItemContainerStyle" TargetType="ListBoxItem">
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="Margin" Value="0,6" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="Root"
                                Background="{TemplateBinding Background}"
                                Padding="16"
                                CornerRadius="8">
                            <ContentPresenter />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="{StaticResource ResultHover}" />
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Root" Property="Background" Value="{StaticResource ResultSelected}" />
                                <Setter Property="Foreground" Value="{StaticResource ResultSelectedText}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="Root" Property="Opacity" Value="0.6" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border Background="{StaticResource ShellFill}"
            BorderBrush="{StaticResource ShellStroke}"
            BorderThickness="1"
            Padding="8">
        <StackPanel>
            <Border Background="{StaticResource SearchBarFill}"
                    Padding="12"
                    CornerRadius="6"
                    Margin="0,0,0,0">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0"
                               Text="&#xE721;"
                               FontFamily="Segoe MDL2 Assets"
                               FontSize="16"
                               Foreground="{StaticResource AccentBrush}"
                               VerticalAlignment="Center"
                               Margin="2,0,10,0" />

                    <Grid Grid.Column="1">
                        <TextBox x:Name="SearchBox"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 FontSize="20"
                                 FontWeight="SemiBold"
                                 Foreground="{StaticResource SearchText}"
                                 Padding="0"
                                 VerticalContentAlignment="Center"
                                 Text="{Binding Query, UpdateSourceTrigger=PropertyChanged}"
                                 KeyDown="SearchBox_KeyDown" />
                        <TextBlock Margin="2,0,0,0"
                                   FontSize="15"
                                   Foreground="{StaticResource SearchPlaceholder}"
                                   VerticalAlignment="Center"
                                   IsHitTestVisible="False">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Text" Value="Search apps, type a URL, or press Enter to use Bing" />
                                    <Setter Property="Visibility" Value="Collapsed" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding Text, ElementName=SearchBox}" Value="">
                                            <Setter Property="Visibility" Value="Visible" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </Grid>

                    <Border Grid.Column="2"
                            Background="{StaticResource BadgeFill}"
                            Padding="10,4"
                            CornerRadius="6"
                            VerticalAlignment="Center">
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="{Binding ToolTip, ElementName=SearchBox, TargetNullValue=Alt+Space}"
                                       Foreground="{StaticResource BadgeText}"
                                       FontSize="12"
                                       Margin="0,0,6,0" />
                            <Ellipse Width="6" Height="6" Fill="{StaticResource AccentBrush}" VerticalAlignment="Center" />
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>

            <Border Margin="0,12,0,0"
                    Background="{StaticResource ResultBackground}"
                    BorderBrush="#1F2435"
                    BorderThickness="1"
                    Padding="12"
                    CornerRadius="6"
                    Visibility="{Binding HasResults, Converter={StaticResource BoolToVisibility}}">
                <Border MaxHeight="360" ClipToBounds="True">
                    <ListBox x:Name="ResultsList"
                             ItemsSource="{Binding Results}"
                             SelectedItem="{Binding SelectedResult, Mode=TwoWay}"
                             BorderThickness="0"
                             Background="Transparent"
                             ScrollViewer.CanContentScroll="True"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             VirtualizingStackPanel.IsVirtualizing="True"
                             VirtualizingStackPanel.VirtualizationMode="Recycling"
                             MouseDoubleClick="ListBox_MouseDoubleClick"
                             PreviewKeyDown="ListBox_PreviewKeyDown"
                             ItemContainerStyle="{StaticResource ResultItemContainerStyle}">
                        <ListBox.ItemTemplate>
                            <DataTemplate DataType="{x:Type vm:SearchResultViewModel}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Border Width="40"
                                            Height="40"
                                            CornerRadius="6"
                                            Background="#1E2230"
                                            VerticalAlignment="Center">
                                        <Image Source="{Binding Icon}"
                                               Width="24"
                                               Height="24"
                                               VerticalAlignment="Center"
                                               HorizontalAlignment="Center" />
                                    </Border>
                                    <StackPanel Grid.Column="1"
                                                Margin="12,0"
                                                VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Title}"
                                                   FontSize="16"
                                                   FontWeight="SemiBold"
                                                   Foreground="{StaticResource PrimaryText}" />
                                        <TextBlock Text="{Binding Subtitle}"
                                                   FontSize="12"
                                                   Foreground="{StaticResource MutedText}"
                                                   TextTrimming="CharacterEllipsis" />
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>
            </Border>
        </StackPanel>
    </Border>
</Window>
